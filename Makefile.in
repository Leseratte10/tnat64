# Makefile used by configure to create real Makefile

CC=@CC@
prefix=@prefix@
exec_prefix = @exec_prefix@
libexecdir = @libexecdir@
sysconfdir = @sysconfdir@
libdir = @libdir@/tnat64
bindir = @bindir@
infodir = @infodir@
mandir = @mandir@
includedir = @includedir@

SHELL = /bin/sh
MKINSTALLDIRS = ${SHELL} mkinstalldirs 
SHCC = ${CC} -fPIC 
LIB_NAME = libtnat64
COMMON = common
PARSER = parser
VALIDATECONF = validateconf
SCRIPT = tnat64
SHLIB_MAJOR = 0
SHLIB_MINOR = 1
SHLIB = ${LIB_NAME}.so.${SHLIB_MAJOR}.${SHLIB_MINOR}

INSTALL = @INSTALL@
INSTALL_DATA = @INSTALL_DATA@
CFLAGS = @CFLAGS@
INCLUDES = -I.
LIBS = @LIBS@
SPECIALLIBS = @SPECIALLIBS@

SHOBJS = ${OBJS:.o=.so}

OBJS= tnat64.o

TARGETS= ${SHLIB} ${UTIL_LIB} ${SAVE} ${INSPECT} ${VALIDATECONF}

all: ${TARGETS}

${VALIDATECONF}: ${VALIDATECONF}.c ${COMMON}.o ${PARSER}.o
	${SHCC} ${CFLAGS} ${INCLUDES} -o ${VALIDATECONF} ${VALIDATECONF}.c ${COMMON}.o ${PARSER}.o ${LIBS}

${SHLIB}: ${OBJS} ${COMMON}.o ${PARSER}.o
	${SHCC} -Wl,-soname,${SHLIB} ${CFLAGS} ${INCLUDES} -nostdlib -shared -o ${SHLIB} ${OBJS} ${COMMON}.o ${PARSER}.o ${DYNLIB_FLAGS} ${SPECIALLIBS} ${LIBS}
	ln -sf ${SHLIB} ${LIB_NAME}.so

%.so: %.c
	${SHCC} ${CFLAGS} ${INCLUDES} -c ${CC_SWITCHES} $< -o $@

%.o: %.c
	${SHCC} ${CFLAGS} ${INCLUDES} -c ${CC_SWITCHES} $< -o $@

install: ${TARGETS} installscript installlib installman

installscript:
	${MKINSTALLDIRS} "${DESTDIR}${bindir}"
	${INSTALL} ${SCRIPT} ${DESTDIR}${bindir}

installlib:
	${MKINSTALLDIRS} "${DESTDIR}${libdir}"
	${INSTALL} ${SHLIB} ${DESTDIR}${libdir}
	ln -sf ${SHLIB} ${DESTDIR}${libdir}/${LIB_NAME}.so

installman:
	${MKINSTALLDIRS} "${DESTDIR}${mandir}/man1"
	${INSTALL_DATA} tnat64.1 ${DESTDIR}${mandir}/man1/
	${MKINSTALLDIRS} "${DESTDIR}${mandir}/man8"
	${INSTALL_DATA} tnat64.8 ${DESTDIR}${mandir}/man8/
	${MKINSTALLDIRS} "${DESTDIR}${mandir}/man5"
	${INSTALL_DATA} tnat64.conf.5 ${DESTDIR}${mandir}/man5/
	
clean:
	-rm -f *.so *.so.* *.o *~ ${TARGETS}

distclean: clean
	-rm -f config.cache config.status config.log config.h Makefile
